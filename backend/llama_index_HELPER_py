from llama_index.core import SimpleDirectoryReader, VectorStoreIndex, StorageContext
from app.pdf_loader import load_pdfs_from_folder
import os


def get_index(embed_model):
    persist_dir = "index"
    uploads_dir = "data/uploads"
    os.makedirs(uploads_dir, exist_ok=True)

    if not os.path.exists(persist_dir):
        # Carrega documentos de PDF
        documents = load_pdfs_from_folder(uploads_dir)
        index = VectorStoreIndex.from_documents(documents, embed_model=embed_model)
        index.storage_context.persist(persist_dir)
    else:
        storage_context = StorageContext.from_defaults(persist_dir=persist_dir)
        index = VectorStoreIndex.from_vector_store(storage_context.vector_store)

    return index
